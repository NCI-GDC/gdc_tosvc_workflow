### To generate a new purecn normaldb
* https://wiki.uchicago.edu/pages/viewpage.action?spaceKey=CDIS&title=Tumor-Only+Filtering+Workflow+Manual
1. clone repo
   * `git@github.com:NCI-GDC/gdc_tosvc_workflow.git`
1. cd `gdc_tosvc_workflow/normaldb`
1. The entrypoint for normaldb generation is `etl.cwl` (extract, transform, load)
1. Example inputs are:
   * `etl.nexterarapidcaptureexomev1.2.cptac-3.hg38.yml`
   * `etl.sureselectxthumanallexonv5,16.tcga-meso.hg38.yml`
   * `etl.xgenexomeresearchpanelv1.0.organoid-pancreatic.hg38.yml`
1. input fields that must be modified for each new kit:
   *. `bam_uuids`
   *. `bam_sizes`
   *. `bam_index_uuids`
   *. `bam_index_sizes`
   *. `project_id`
   *. `target_capture_kit`
1. save, git commit and push
1. rsync repo to a VM
   * `rsync -av -progress gdc_tosvc_workflow ${VM}/mnt/scratch/`
1. run workflow
   * `cd /mnt/scratch/`
   * `mkdir run && cd run/`
   * `nohup cwltool --debug --cachedir $(pwd)/cache/ --tmpdir-prefix $(pwd)/tmp/ /mnt/scratch/gdc_tosvc_workflow/normaldb/etl.cwl /mnt/scratch/gdc_tosvc_workflow/normaldb/etl.xgenexomeresearchpanelv1.0.organoid-pancreatic.hg38.yml &`
1. output will 4 files. in the above example:
   * `interval_weights.xgenexomeresearchpanelv1.0.organoid-pancreatic.hg38.png`
   * `interval_weights.xgenexomeresearchpanelv1.0.organoid-pancreatic.hg38.txt`
   * `low_coverage_targets.xgenexomeresearchpanelv1.0.organoid-pancreatic.hg38.bed`
   * `normalDB.xgenexomeresearchpanelv1.0.organoid-pancreatic.hg38.rds`
1. files to be used by workflows
   * `interval_weights.*.hg38.txt`
   * `normalDB.*.rds`
1. these files should be placed in an object store
   * as with files generated by https://github.com/NCI-GDC/gdc_bed_liftover/
   * I use `awscli`. Our ceph/cleversafe store only works with older versions of `awscli` (Sean Sullivan knows the details).
     * The virtualenv I use:
       * `mkvirtualenv --python /usr/bin/python3 p3`
       * `pip install awscli==1.10.50`
       * `awscli` config:
       * `~/.aws/config` [0]
       * `~/.aws/credentials` [1]
       * example object store write:
         ```bash
         aws s3 cp --profile ceph --endpoint-url http://gdc-cephb-objstore.osdc.io/ interval_weights.*.hg38.txt s3://capture-kits/auto/
         aws s3 cp --profile ceph --endpoint-url http://gdc-cephb-objstore.osdc.io/ normalDB.*.rds s3://capture-kits/auto/
         ```
1. these files should be made available to biowcs and entered into indexd
   * https://github.com/NCI-GDC/gdc_bed_liftover/blob/master/gdc_bed_liftover/create_enum_map.py
     * creates biowcs `kit_enum_map.json`
     * creates `indexd_records.json` for bioindexd update
   1. `git clone git@github.com:NCI-GDC/gdc_bed_liftover.git`
   1. Modify `gdc_bed_liftover/map_file_kit.ods` with `oocalc`
      1. Find the row for the bait file of the target capture kit, and populate:
         * `normaldb_rds` (column N)
         * `normaldb_txt` (column O)
         * one UUID values will need to be generated for each column, followed by a comma, and then the filename.
         * example kit: `xGen Exome Research Panel v1.0`
         * Save `map_file_kit.ods`
         * Select `File > Save As...` and select `Text CSV (csv)` from the menu above the `Save` button. Then click `Save`. If a dialog asks if you are sure, select `Use Text CSV Format`. Then, `Character set: Unicode (UTF-8)`, `Field delimiter: {Tab}`, `String delimiter: "`. Check `Save cell content as shown` and `Quote all text cells`. Click `OK`.
         * Quit `oocalc`
         * Use the terminal to `mv map_file_kit.csv map_file_kit.tsv`.
         * `git commit -am "updated with new normaldb"`



[0]:
```bash
(p3) ubuntu@jeremiah-node001:~$ cat .aws/config 
[default]
s3 =
  max_concurrent_requests = 1
  max_queue_size = 10000
  multipart_threshold = 5GB
  multipart_chunksize = 5GB

[ceph]
s3 =
  max_concurrent_requests = 1
  max_queue_size = 10000
  multipart_threshold = 5GB
  multipart_chunksize = 5GB

[cleversafe]
s3 =
  max_concurrent_requests = 1
  max_queue_size = 10000
  multipart_threshold = 5GB
  multipart_chunksize = 5GB
```
[1]:
```bash
(p3) ubuntu@jeremiah-node001:~$ cat .aws/credentials
[default]
aws_access_key_id = xxx
aws_secret_access_key = xxx
[ceph]
aws_access_key_id = xxx
aws_secret_access_key = xxx
[cleversafe]
aws_secret_access_key = xxx
aws_access_key_id = xxx
[aws_secure]
aws_access_key_id = xxx
aws_secret_access_key = xxx
```
